<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Booking System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10 px-4">

  <h1 class="text-3xl font-bold mb-6 text-gray-800">ðŸ“… Book a Slot</h1>

  <!-- Slot List -->
  <div id="slots" class="w-full max-w-2xl bg-white shadow-lg rounded-xl p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Available Slots</h2>
    <div id="slotList" class="space-y-2"></div>
  </div>

  <!-- Booking Form -->
  <div id="form" class="w-full max-w-lg bg-white shadow-lg rounded-xl p-6">
    <h2 class="text-xl font-semibold mb-4">Booking Form</h2>
    <form id="bookingForm" class="space-y-4">
      <input type="text" id="name" placeholder="Your Name" required
        class="w-full border rounded-lg px-3 py-2">
      <input type="email" id="email" placeholder="Your Email" required
        class="w-full border rounded-lg px-3 py-2">
      <input type="text" id="date" readonly placeholder="Date"
        class="w-full border rounded-lg px-3 py-2 bg-gray-100 cursor-not-allowed">
      <input type="text" id="time" readonly placeholder="Time"
        class="w-full border rounded-lg px-3 py-2 bg-gray-100 cursor-not-allowed">
      <textarea id="notes" placeholder="Notes (optional)"
        class="w-full border rounded-lg px-3 py-2"></textarea>
      <button type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg">
        Confirm Booking
      </button>
    </form>
    <p id="status" class="mt-4 text-center font-medium"></p>
  </div>

  <script>
    const API_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL";
    let selectedDate = "";
    let selectedTime = "";

    // Fetch slots
    function loadSlots() {
      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          const slotList = document.getElementById("slotList");
          slotList.innerHTML = "";

          data.slots.forEach(slot => {
            const slotBtn = document.createElement("button");
            slotBtn.className = "w-full text-left px-4 py-2 rounded-lg border " +
                                (slot.Status === "booked"
                                  ? "bg-red-100 text-red-600 cursor-not-allowed"
                                  : "bg-green-100 text-green-700 hover:bg-green-200");
            slotBtn.textContent = `${slot.Date} @ ${slot.Time} - ${slot.Status}`;
            slotBtn.disabled = slot.Status === "booked";

            if (slot.Status === "free") {
              slotBtn.onclick = () => {
                document.getElementById("date").value = slot.Date;
                document.getElementById("time").value = slot.Time;
                selectedDate = slot.Date;
                selectedTime = slot.Time;
              };
            }
            slotList.appendChild(slotBtn);
          });
        });
    }

    // Handle booking
    document.getElementById("bookingForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const notes = document.getElementById("notes").value;

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ name, email, date: selectedDate, time: selectedTime, notes })
      })
      .then(res => res.json())
      .then(result => {
        const statusEl = document.getElementById("status");
        statusEl.textContent = result.message;
        statusEl.className = "mt-4 text-center font-medium " +
          (result.success ? "text-green-600" : "text-red-600");
        if (result.success) loadSlots(); // refresh slot list
      });
    });

    loadSlots();
  </script>
</body>
</html>
